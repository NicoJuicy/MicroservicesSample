version: '3'

services:

  # --- Notes Service ---

  notes-service:
    image: eposgmbh/notes-webapi:latest
    restart: always
    build: ../src/services/notes
    entrypoint: >
      /svc/wait-for-it.sh --strict --timeout=30 postgres:5432 --
      /svc/wait-for-it.sh --strict --timeout=30 rabbitmq:5672 --
      dotnet Notes.WebApi.dll
    ports:
      - 80:80
    depends_on:
      - postgres
      - rabbitmq

  postgres:
    image: postgres:10.3 # https://hub.docker.com/_/postgres/
    restart: always
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: root
      POSTGRES_PASSWORD: JklM8765
    ports:
      - 5432:5432

# --- Volumes ---

volumes:
  postgres-data:
